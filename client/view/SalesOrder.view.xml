<mvc:View
	controllerName="tms.basic.controller.SalesOrder"
	xmlns:mvc="sap.ui.core.mvc"
  xmlns:core="sap.ui.core"
  xmlns="sap.uxap"
  xmlns:l="sap.ui.layout"
	xmlns:f="sap.ui.layout.form"
	displayBlock="true"
	xmlns:m="sap.m">
  <ObjectPageLayout
    id="salesOrder"
    useIconTabBar="true"
    showHeaderContent="true"
    showTitleInHeaderContent="true">
    <headerTitle>
      <ObjectPageHeader objectTitle="{number}" isObjectTitleAlwaysVisible="false" >
        <actions>
					<ObjectPageHeaderActionButton icon="sap-icon://account" enabled="false"/>
        </actions>
        <breadcrumbs>
          <m:Breadcrumbs currentLocationText="{i18n>salesOrder}">
						<m:Link text="{i18n>home}" href="#"/>
						<m:Link text="{i18n>salesOrders}" href="#/sales-orders"/>
					</m:Breadcrumbs>
        </breadcrumbs>
        
      </ObjectPageHeader>
    </headerTitle>
    <headerContent>
      <m:ToolbarSpacer />
      <m:ObjectStatus
        title="{i18n>date}"
        text="{
          path: 'dateTime',
          type: 'sap.ui.model.type.DateTime',
          formatOptions: {
            style: 'short',
            strictParsing: true,
            source: {
              UTC: true,
              pattern: 'yyyy-MM-dd\'T\'HH:mm:ss.SSSZ'
            }
          }
        }"
      />
      <m:ObjectStatus title="{i18n>untaxedAmount}" text="{untaxedAmount}"/>
      <m:ObjectStatus title="{i18n>taxes}" text="{taxes}"/>
      <m:ObjectStatus title="{i18n>total}" text="{total}"/>
      <!--<m:ObjectStatus title="{i18n>total}" text="{path: '/Rows', formatter: '.formatter.salesOrderTotal'}"/>-->

      <m:SegmentedButton selectedKey="{statusKey}">
				<m:items>
					<m:SegmentedButtonItem text="Создан" key="created"/>
					<m:SegmentedButtonItem text="Подтвержден" key="confirmed"/>
					<m:SegmentedButtonItem text="Выставлен счет" key="invoiced"/>
					<m:SegmentedButtonItem text="Оплачен" key="payed"/>
					<m:SegmentedButtonItem text="Закрыт" key="closed"/>
					<m:SegmentedButtonItem text="Отменен" key="cancelled"/>
				</m:items>
			</m:SegmentedButton>
    </headerContent>
    <sections>
      <ObjectPageSection title="{i18n>common}">
        <subSections>
          <ObjectPageSubSection title="{i18n>common}">
            <blocks>
              <f:SimpleForm
                editable="true"
                layout="ResponsiveGridLayout">
                <f:content>
                  <m:Label text="{i18n>name}"/>
                  <m:Input value="{name}" id="n"/>
                  <m:Label text="{i18n>customer}"/>
                  <m:Input value="{customerName}"/>
                  <m:Label text="{i18n>invoicingAddress}"/>
                  <m:Input value="{invoicingAddress}"/>
                  <m:Label text="{i18n>deliveryAddress}"/>
                  <m:Input value="{deliveryAddress}"/>
                  <m:Label text="{i18n>salesPerson}"/>
                  <m:Select
                    forceSelection="false"
                    selectedKey="{salesPersonId}"
                    items="{
                      path: '/Employees',
                      filters: [
                        {
                          path: 'isSalesPerson',
                          operator: 'EQ',
                          value1: 'true'
                        }
                      ]
                    }">
                    <core:Item key="{_id}" text="{= ${firstName} + ' ' + ${lastName}}" />
                  </m:Select>
                </f:content>
              </f:SimpleForm>
            </blocks>
          </ObjectPageSubSection>
        </subSections>
      </ObjectPageSection>
      <ObjectPageSection title="{i18n>rows}">
        <subSections>
          <ObjectPageSubSection title="{i18n>rows}">
            <blocks>
              <m:VBox>
                <m:Table
                  id="salesOrderRows"
                  growing="true"
                  growingThreshold="100"
                  delete="onDeleteRowPress"
                  mode="Delete"
                  >
                  <m:headerToolbar>
                    <m:Toolbar>
                      <m:ToolbarSpacer />
                      <m:Button icon="sap-icon://add" press="onAddActionPress"/>
                    </m:Toolbar>
                  </m:headerToolbar>
                  <m:columns>
                    <m:Column width="40%">
                      <m:Text text="{i18n>product}"/>
                    </m:Column>
                    <m:Column>
                      <m:Text text="{i18n>qty}"/>
                    </m:Column>
                    <m:Column>
                      <m:Text text="{i18n>unitPrice}"/>
                    </m:Column>
                    <m:Column>
                      <m:Text text="{i18n>taxes}"/>
                    </m:Column>
                    <m:Column>
                      <m:Text text="{i18n>discountPercent}"/>
                    </m:Column>
                    <!--<m:Column>
                      <m:Text text="{i18n>subtotal}"/>
                    </m:Column>-->
                  </m:columns>
                </m:Table>
                <f:SimpleForm
                  title="{i18n>salesOrderRow}"
                  id="salesOrderRowForm"
                  visible="false"
                  editable="true"
                  layout="ResponsiveGridLayout"
                  class="editableForm">
                  <f:content>
                    <m:Label text="{i18n>product}"/>
                    <m:Input value="{productName}"/>
                    <m:Label text="{i18n>qty}"/>
                    <m:Input value="{quantity}"/>
                    <m:Label text="{i18n>unitPrice}"/>
                    <m:Input value="{unitPrice}"/>
                    <m:Label text="{i18n>discountPercent}"/>
                    <m:Input value="{discountPercent}"/>
                  </f:content>
                </f:SimpleForm>
              </m:VBox>
            </blocks>
          </ObjectPageSubSection>
        </subSections>
      </ObjectPageSection>
    </sections>
  </ObjectPageLayout>
</mvc:View>
